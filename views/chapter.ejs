<% const _chapters = Array.isArray(manga.chapters) ? manga.chapters : []; %>
<% const _idx = _chapters.findIndex(ch => ch.slug === chapter.slug); %>
<% const prevChapter = _idx > 0 ? _chapters[_idx - 1] : null; %>
<% const nextChapter = _idx >= 0 && _idx < _chapters.length - 1 ? _chapters[_idx + 1] : null; %>

<nav class="sticky top-0 z-30 bg-surface/95 backdrop-blur border-b border-white/5">
  <div class="max-w-4xl mx-auto px-4 py-3 flex flex-wrap items-center gap-2 justify-center">
    <div>
      <% if (prevChapter) { %>
        <a href="/manga/<%= manga.slug %>/<%= prevChapter.slug %>" class="px-3 py-2 rounded bg-surface2 hover:bg-surface">Prev</a>
      <% } else { %>
        <button class="px-3 py-2 rounded bg-surface2 opacity-50" disabled>Prev</button>
      <% } %>
    </div>
    <div>
        <select class="chapter-select bg-surface2 rounded px-2 py-2">
          <% _chapters.forEach(ch => { %>
            <option value="/manga/<%= manga.slug %>/<%= ch.slug %>" <%= ch.slug === chapter.slug ? 'selected' : '' %>><%= ch.title %></option>
          <% }); %>
        </select>
    </div>
    <div>
        <select class="page-select bg-surface2 rounded px-2 py-2">
          <% pages.forEach((page, index) => { %>
            <option value="#page-<%= index + 1 %>">Page <%= index + 1 %></option>
          <% }); %>
        </select>
    </div>
    <div>
      <button class="px-3 py-2 rounded bg-brand hover:bg-indigo-500 text-white" id="fullscreen-button">Fullscreen</button>
    </div>
    <div>
      <% if (nextChapter) { %>
        <a href="/manga/<%= manga.slug %>/<%= nextChapter.slug %>" class="px-3 py-2 rounded bg-surface2 hover:bg-surface">Next</a>
      <% } else { %>
        <button class="px-3 py-2 rounded bg-surface2 opacity-50" disabled>Next</button>
      <% } %>
    </div>
  </div>
</nav>

<div class="max-w-4xl mx-auto px-4 py-4 text-center">
  <h1 class="text-lg font-semibold"><a href="/manga/<%= manga.slug %>" class="hover:text-brand"><%= manga.title %></a> - <%= chapter.title %></h1>
  </div>

<div class="max-w-4xl mx-auto px-2 page-container">
  <% pages.forEach((page, index) => { %>
    <div class="text-center">
        <img class="w-full h-auto" src="<%= page %>" alt="Page <%= index + 1 %>" id="page-<%= index + 1 %>">
    </div>
  <% }); %>
</div>

<div class="chapter-bottom-bar">
  <div class="buttons is-centered">
    <% if (prevChapter) { %>
      <a href="/manga/<%= manga.slug %>/<%= prevChapter.slug %>" class="button is-small is-primary">Prev</a>
    <% } else { %>
      <button class="button is-small" disabled>Prev</button>
    <% } %>
    <button class="button is-small" id="go-to-top-button-mobile">Top</button>
    <% if (nextChapter) { %>
      <a href="/manga/<%= manga.slug %>/<%= nextChapter.slug %>" class="button is-small is-primary">Next</a>
    <% } else { %>
      <button class="button is-small" disabled>Next</button>
    <% } %>
  </div>
  </div>

<button id="go-to-top-button" class="hidden fixed bottom-5 right-5 px-3 py-3 rounded-full bg-brand text-white shadow-lg">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-up"><polyline points="18 15 12 9 6 15"></polyline></svg>
</button>

<script src="/js/chapter.js"></script>
