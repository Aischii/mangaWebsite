<div class="grid grid-cols-1 md:grid-cols-3 gap-6">
  <div>
    <div class="relative w-full pt-[150%] rounded overflow-hidden bg-surface2">
      <img src="<%= manga.cover %>" alt="<%= manga.title %>" class="absolute inset-0 w-full h-full object-cover">
    </div>
  </div>
  <div class="md:col-span-2">
    <h1 class="text-2xl font-bold mb-2 flex items-center gap-2">
      <span><%= manga.title %></span>
      <% if (user && user.role === 'admin') { %>
        <a href="/manga/<%= manga.slug %>/edit" class="text-sm px-3 py-1.5 rounded bg-surface2 hover:bg-surface">Edit</a>
      <% } %>
    </h1>
    <div class="text-sm text-gray-300 space-y-1">
      <p><span class="font-semibold text-gray-200">Alternative Title:</span> <%= manga.otherTitle %></p>
      <p><span class="font-semibold text-gray-200">Author:</span> <%= manga.author %></p>
      <p><span class="font-semibold text-gray-200">Artist:</span> <%= manga.artist %></p>
      <p><span class="font-semibold text-gray-200">Genre:</span> <%= Array.isArray(manga.genre) ? manga.genre.join(', ') : manga.genre %></p>
    </div>
    <p class="mt-3 text-gray-200"><%= manga.synopsis %></p>
    <div class="mt-4 flex gap-2">
      <% if (manga.chapters && manga.chapters.length) { %>
        <% const latest = manga.chapters[manga.chapters.length - 1]; %>
        <a href="/manga/<%= manga.slug %>/<%= latest.slug %>" class="px-4 py-2 rounded bg-brand hover:bg-indigo-500 text-white">Read Latest</a>
      <% } %>
      <% if (user) { %>
        <% if (user && user.bookmarks && user.bookmarks.includes(manga.id)) { %>
          <form action="/manga/<%= manga.slug %>/unbookmark" method="POST">
            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
            <button type="submit" class="px-4 py-2 rounded bg-rose-600 hover:bg-rose-500">Remove Bookmark</button>
          </form>
        <% } else { %>
          <form action="/manga/<%= manga.slug %>/bookmark" method="POST">
            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
            <button type="submit" class="px-4 py-2 rounded bg-surface2 hover:bg-surface">Add Bookmark</button>
          </form>
        <% } %>
      <% } %>
    </div>
  </div>
</div>

<hr>

<div class="level">
  <div class="level-left">
    <h2 class="title is-4 has-text-white">Chapters</h2>
  </div>
  <div class="level-right">
    <% if (user && user.role === 'admin') { %>
      <a href="/manga/<%= manga.slug %>/upload-chapter" class="button is-primary">Upload Chapter</a>
    <% } %>
  </div>
</div>
<div class="mt-6">
  <h2 class="text-xl font-semibold mb-3">Chapters</h2>
  <div class="divide-y divide-white/5 bg-surface rounded overflow-hidden">
    <% manga.chapters.forEach(chapter => { %>
      <div class="flex items-center justify-between p-3 hover:bg-surface2">
        <a href="/manga/<%= manga.slug %>/<%= chapter.slug %>" class="truncate"><%= chapter.title %></a>
        <% if (user && user.role === 'admin') { %>
          <a href="/manga/<%= manga.slug %>/<%= chapter.slug %>/edit" class="text-sm px-3 py-1 rounded bg-surface2 hover:bg-surface">Edit</a>
        <% } %>
      </div>
    <% }); %>
  </div>
</div>
